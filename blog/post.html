<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blog 详情</title>
  <meta name="description" content="查看 OCTest 的深度解读文章，涵盖 AgeTech、AI 与新加坡政策等关键专题。">
  <meta name="keywords" content="OCTest,博客,深度解读,AgeTech,AI">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://waymochang.github.io/OCTest/blog/post.html">
  <meta property="og:title" content="Blog 详情 | OCTest">
  <meta property="og:description" content="查看 OCTest 的深度解读文章，涵盖 AgeTech、AI 与新加坡政策等关键专题。">
  <meta property="og:url" content="https://waymochang.github.io/OCTest/blog/post.html">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="OCTest">
  <meta property="og:image" content="https://waymochang.github.io/OCTest/assets/og-image.png">
  <meta property="og:locale" content="zh-CN">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Blog 详情 | OCTest">
  <meta name="twitter:description" content="查看 OCTest 的深度解读文章，涵盖 AgeTech、AI 与新加坡政策等关键专题。">
  <meta name="twitter:image" content="https://waymochang.github.io/OCTest/assets/og-image.png">
  <meta name="twitter:site" content="@WaymoChang">
  <link rel="stylesheet" href="./assets/blog.css" />
  <script src="../assets/seo-helper.js"></script>
</head>
<body>
  <header class="topbar">
    <a class="brand" href="./index.html">← 返回列表</a>
    <h1>Blog 详情</h1>
      <button id="theme-toggle" class="theme-toggle" type="button">☀️ Light</button>
  </header>

  <main class="container">
    <article id="post" class="post"></article>
  </main>

    <script>
    const siteBase = "https://waymochang.github.io/OCTest";
    const defaultOgImage = `${siteBase}/assets/og-image.png`;
    async function loadPostsData() {
      const res = await fetch(`./assets/posts.json?v=${Date.now()}`, { cache: 'no-store' });
      if (!res.ok) throw new Error('Failed to load posts.json');
      return await res.json();
    }

    (async () => {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get('slug');
      const posts = await loadPostsData();
      const post = posts.find((p) => p.slug === slug);
      const root = document.getElementById('post');

      if (!post) {
        const h2 = document.createElement('h2');
        h2.textContent = '未找到文章';
        const p = document.createElement('p');
        p.textContent = '请返回列表选择文章。';
        root.replaceChildren(h2, p);
      } else {
        const fmt = (d) => new Date(d).toLocaleDateString('zh-CN', { year: 'numeric', month: 'short', day: 'numeric' });

        const h2 = document.createElement('h2');
        h2.textContent = post.title || '';

        const meta = document.createElement('p');
        meta.className = 'meta';
        meta.textContent = `${fmt(post.date)} · ${post.author || ''}`;

        const content = document.createElement('div');
        content.className = 'content';

        const lines = post.content || [];

        const summaryText = (() => {
          const ex = (post.excerpt || '').trim();
          if (ex) return ex;

          const candidates = lines
            .map((x) => (x || '').trim())
            .filter(Boolean)
            .filter((t) => !/^[一二三四五六七八九十]+、/.test(t))
            .filter((t) => !/^【.*】/.test(t))
            .filter((t) => !/^原文链接[:：]/.test(t))
            .filter((t) => !/^版权说明[:：]/.test(t))
            .filter((t) => !/^结语/.test(t))
            .filter((t) => !/^[-•]\s+/.test(t))
            .filter((t) => t.length >= 24);

          return candidates[0] || '';
        })();

        const articleUrl = `${siteBase}/blog/post.html?slug=${encodeURIComponent(post.slug || '')}`;
        const articleDescription = summaryText || post.excerpt || 'OCTest 博客深度解读文章。';
        const publishedDate = new Date(post.sourceDate || post.date || Date.now()).toISOString();
        if (window.applySeoMetadata) {
          window.applySeoMetadata({
            title: `${post.title} · OCTest Blog`,
            description: articleDescription,
            url: articleUrl,
            ogType: 'article',
            image: defaultOgImage,
            keywords: 'OCTest,博客,AgeTech,AI'
          });
        }
        if (window.injectStructuredData) {
          window.injectStructuredData({
            "@context": "https://schema.org",
            "@type": "BlogPosting",
            "headline": post.title,
            "description": articleDescription,
            "datePublished": publishedDate,
            "author": {
              "@type": "Person",
              "name": post.author || 'OCTest'
            },
            "publisher": {
              "@type": "Organization",
              "name": "OCTest",
              "url": siteBase,
              "logo": {
                "@type": "ImageObject",
                "url": defaultOgImage
              }
            },
            "mainEntityOfPage": {
              "@type": "WebPage",
              "@id": articleUrl
            },
            "image": defaultOgImage
          });
        }

        if (summaryText) {
          const summary = document.createElement('div');
          summary.className = 'summary-box';

          const st = document.createElement('div');
          st.className = 'summary-title';
          st.textContent = '核心摘要';

          const sp = document.createElement('p');
          sp.textContent = summaryText;

          summary.appendChild(st);
          summary.appendChild(sp);
          content.appendChild(summary);
        }

        (lines).forEach((line) => {
          const text = (line || '').trim();

          if (!text) {
            const gap = document.createElement('div');
            gap.className = 'line-gap';
            content.appendChild(gap);
            return;
          }

          if (/^[一二三四五六七八九十]+、/.test(text)) {
            const h3 = document.createElement('h3');
            h3.className = 'section-title';
            h3.textContent = text;
            content.appendChild(h3);
            return;
          }

          if (/^[-•]\s+/.test(text)) {
            const li = document.createElement('p');
            li.className = 'bullet-line';
            li.textContent = text.replace(/^[-•]\s+/, '');
            content.appendChild(li);
            return;
          }

          if (/^【.*】/.test(text) || /^原文链接[:：]/.test(text) || /^版权说明[:：]/.test(text) || /^结语/.test(text)) {
            const callout = document.createElement('p');
            callout.className = 'callout-line';

            if (/^原文链接[:：]/.test(text)) {
              const m = text.match(/^原文链接[:：]\s*(https?:\/\/\S+)\s*$/i);
              if (m) {
                const label = document.createElement('span');
                label.textContent = '原文链接：';

                const link = document.createElement('a');
                link.href = m[1];
                link.textContent = m[1];
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                link.className = 'source-link';

                callout.appendChild(label);
                callout.appendChild(link);
                content.appendChild(callout);
                return;
              }
            }

            callout.textContent = text;
            content.appendChild(callout);
            return;
          }

          const para = document.createElement('p');
          para.className = 'body-line';
          para.textContent = text;
          content.appendChild(para);
        });

        root.replaceChildren(h2, meta, content);
      }
    })();
  </script>
  <script src="../assets/theme.js"></script>
  <script src="../assets/analytics-config.js"></script>
  <script src="../assets/analytics.js"></script>
</body>
</html>
