<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OCTest Blog</title>
  <link rel="stylesheet" href="./assets/blog.css" />
</head>
<body>
  <header class="topbar">
    <a class="brand" href="../index.html">← OCTest</a>
    <h1>Blog 列表</h1>
      <button id="theme-toggle" class="theme-toggle" type="button">☀️ Light</button>
  </header>

  <main class="container">
    <section class="intro">
      <p>这里是博客结构页（占位版）。你后续给我真实内容后，我会直接填进去。</p>
    </section>

    <section id="post-list" class="grid"></section>
  </main>

    <script>
    async function loadPostsData() {
      const res = await fetch(`./assets/posts.json?v=${Date.now()}`, { cache: 'no-store' });
      if (!res.ok) throw new Error('Failed to load posts.json');
      return await res.json();
    }

    (async () => {
      const list = document.getElementById('post-list');
      const fmt = (d) => new Date(d).toLocaleDateString('zh-CN', { year: 'numeric', month: 'short', day: 'numeric' });
      const posts = await loadPostsData();
      const sortedPosts = [...posts].sort((a, b) => {
        const da = new Date((a.sourceDate || a.date || '') + 'T00:00:00').getTime() || 0;
        const db = new Date((b.sourceDate || b.date || '') + 'T00:00:00').getTime() || 0;
        return db - da;
      });

      sortedPosts.forEach((p) => {
        const card = document.createElement('article');
        card.className = 'card';

        const h2 = document.createElement('h2');
        h2.textContent = p.title || '';

        const meta = document.createElement('p');
        meta.className = 'meta';
        meta.textContent = `${fmt(p.sourceDate || p.date)} · ${p.author || ''}`;

        const excerpt = document.createElement('p');
        excerpt.className = 'excerpt';
        excerpt.textContent = p.excerpt || '';

        const a = document.createElement('a');
        a.className = 'btn';
        a.href = `./post.html?slug=${encodeURIComponent(p.slug || '')}`;
        a.textContent = '阅读详情';

        card.appendChild(h2);
        card.appendChild(meta);
        card.appendChild(excerpt);
        card.appendChild(a);
        list.appendChild(card);
      });
    })();
  </script>
  <script src="../assets/theme.js"></script>
  <script src="../assets/analytics-config.js"></script>
  <script src="../assets/analytics.js"></script>
</body>
</html>
